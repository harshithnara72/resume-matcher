import streamlit as st
import pdfplumber
from sentence_transformers import SentenceTransformer
from sklearn.metrics.pairwise import cosine_similarity

# Load SBERT Model
model = SentenceTransformer("all-MiniLM-L6-v2")

# Function to extract text from PDF
def extract_text_from_pdf(uploaded_file):
    text = ""
    with pdfplumber.open(uploaded_file) as pdf:
        for page in pdf.pages:
            text += page.extract_text() + "\n"
    return text

# Function to calculate similarity
def calculate_match(resume_text, job_desc):
    resume_embedding = model.encode([resume_text])
    jd_embedding = model.encode([job_desc])

    similarity = cosine_similarity(resume_embedding, jd_embedding)[0][0]
    return round(similarity * 100, 2)

# Streamlit UI
st.set_page_config(page_title="Resume Matcher", page_icon="ğŸ“„", layout="centered")

st.title("ğŸ“„ Resume Screening & Job Matching System")
st.write("Upload your Resume and paste the Job Description to get a match score.")

# Upload Resume
uploaded_resume = st.file_uploader("ğŸ“Œ Upload Resume (PDF)", type=["pdf"])

# Job Description Input
job_description = st.text_area("ğŸ“ Paste Job Description Here", height=200)

if st.button("ğŸ” Check Match Percentage"):
    if uploaded_resume is None:
        st.warning("âš ï¸ Please upload a resume PDF.")
    elif job_description.strip() == "":
        st.warning("âš ï¸ Please enter the job description.")
    else:
        # Extract resume text
        resume_text = extract_text_from_pdf(uploaded_resume)

        # Calculate match
        match_score = calculate_match(resume_text, job_description)

        st.success(f"âœ… Resume Match Score: {match_score}%")

        # Display extracted resume text (optional)
        with st.expander("ğŸ“„ View Extracted Resume Text"):
            st.write(resume_text)
